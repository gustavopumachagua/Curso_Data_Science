| **Inicio**            | **atr谩s 17**         | **Siguiente 19**                        |
| --------------------- | -------------------- | --------------------------------------- |
| [](../../README.md) | [](./17.Vistas.md) | [](./19.Backup_y_Restore_DataBase.md) |

---

## **ndice**

| Temario                                                                   |
| ------------------------------------------------------------------------- |
| [Introducci贸n](#introducci贸n)                                             |
| [驴Qu茅 es un Trigger? Tipos posibles](#驴qu茅-es-un-trigger-tipos-posibles)  |
| [Creaci贸n de Trigger de tipo INSERT](#creaci贸n-de-trigger-de-tipo-insert) |
| [Conclusi贸n](#conclusi贸n)                                                 |

---

# **Trigger**

---

## **Introducci贸n**

Los Triggers (disparadores) en SQL Server son objetos de base de datos que se utilizan para automatizar acciones o responder a eventos espec铆ficos que ocurren en una tabla, como la inserci贸n, actualizaci贸n o eliminaci贸n de registros. Los triggers se ejecutan autom谩ticamente en respuesta a eventos definidos y pueden contener c贸digo `T-SQL` para realizar acciones adicionales en la base de datos.

A continuaci贸n, te proporcionar茅 una explicaci贸n detallada de los `triggers` en SQL Server con un ejemplo utilizando la base de datos Northwind:

1. **Creaci贸n de un Trigger:**

Para crear un `trigger`, se utiliza la sentencia `CREATE TRIGGER`. Especificamos el nombre del `trigger`, la tabla a la que est谩 asociado y el evento que activar谩 el `trigger` (`INSERT`, `UPDATE` o `DELETE`). Tambi茅n definimos el tipo de `trigger` (`AFTER` o `INSTEAD OF`) y la acci贸n que se realizar谩 en el c贸digo del trigger.

Ejemplo de creaci贸n de un trigger en la tabla `Orders` de la base de datos Northwind que se activar谩 despu茅s de una inserci贸n:

```
CREATE TRIGGER OrderInserted
ON Orders
AFTER INSERT
AS
BEGIN
    -- C贸digo del trigger
END;
```

2. **C贸digo del Trigger:**

El c贸digo del `trigger` se encuentra dentro del bloque `BEGIN-END` y se ejecuta autom谩ticamente cuando se activa el evento especificado. El c贸digo puede contener consultas SQL y otras instrucciones `T-SQL` para realizar acciones adicionales en la base de datos. Por ejemplo, podemos insertar datos en otra tabla, actualizar registros relacionados, enviar notificaciones por correo electr贸nico, etc.

Ejemplo de c贸digo de `trigger` que inserta una fila en la tabla `OrderDetails` cuando se inserta una nueva orden:

```
CREATE TRIGGER OrderInserted
ON Orders
AFTER INSERT
AS
BEGIN
    INSERT INTO OrderDetails (OrderID, ProductID, Quantity)
    SELECT i.OrderID, p.ProductID, 1
    FROM inserted i
    INNER JOIN Products p ON i.ProductID = p.ProductID;
END;
```

En este ejemplo, el `trigger` se activa despu茅s de la inserci贸n de una nueva fila en la tabla `Orders`. El c贸digo del `trigger` realiza una inserci贸n en la tabla `OrderDetails` utilizando los datos de la fila reci茅n insertada en la tabla `Orders` y realiza una selecci贸n de la tabla `Products` para obtener el `ProductID` correspondiente.

3. **Tipos de Triggers:**

- **AFTER TRIGGER:** Se ejecuta despu茅s de que se haya realizado la acci贸n en la tabla (`INSERT`, `UPDATE` o `DELETE`).
- **INSTEAD OF TRIGGER:** Se ejecuta en lugar de la acci贸n original en la tabla. Se utiliza com煤nmente para realizar validaciones adicionales o acciones personalizadas antes de realizar la acci贸n original.

4. **Gesti贸n de Triggers:**

Los triggers se pueden modificar, desactivar o eliminar seg煤n sea necesario. Puedes utilizar las sentencias `ALTER TRIGGER`, `DISABLE TRIGGER` y `DROP TRIGGER` respectivamente para realizar estas acciones.

Es importante tener en cuenta que los triggers pueden afectar el rendimiento de la base de datos si no se dise帽an o gestionan correctamente. Es recomendable utilizar los triggers de manera cuidadosa y tener en cuenta las implicaciones en cuanto a la integridad de los datos y el rendimiento de las operaciones.

En resumen, los triggers en SQL Server son objetos de base de datos que se utilizan para automatizar acciones o responder a eventos espec铆ficos en una tabla. Permiten ejecutar c贸digo adicional en respuesta a la inserci贸n, actualizaci贸n o eliminaci贸n de registros. Los triggers pueden realizar acciones como la inserci贸n, actualizaci贸n o eliminaci贸n de datos en otras tablas, enviar notificaciones, realizar validaciones adicionales, entre otras. Son una herramienta poderosa para mantener la integridad de los datos y automatizar tareas en una base de datos.

[](#铆ndice)

---

## **驴Qu茅 es un Trigger? Tipos posibles**

Un `trigger` en SQL Server es un objeto de base de datos que se utiliza para realizar acciones autom谩ticas en respuesta a eventos espec铆ficos que ocurren en una tabla. Estos eventos pueden ser la inserci贸n, actualizaci贸n o eliminaci贸n de registros en la tabla. Los `triggers` permiten ejecutar un conjunto de instrucciones `T-SQL` cuando se produce el evento definido, lo que brinda la posibilidad de realizar acciones adicionales en la base de datos.

Existen dos tipos de triggers en SQL Server:

1. **AFTER TRIGGER:**

Un `AFTER TRIGGER` se ejecuta despu茅s de que se haya completado la acci贸n que lo activ贸. Por ejemplo, un `AFTER INSERT TRIGGER` se ejecutar谩 despu茅s de que se haya insertado una fila en la tabla. Este tipo de `trigger` es el m谩s com煤nmente utilizado.

Ejemplo de un `AFTER TRIGGER` en la tabla `Orders` de la base de datos Northwind:

```
CREATE TRIGGER OrderInserted
ON Orders
AFTER INSERT
AS
BEGIN
    -- C贸digo del trigger
END;
```

En este caso, el `trigger` "`OrderInserted`" se activar谩 despu茅s de insertar una fila en la tabla "`Orders`". Puedes escribir el c贸digo necesario dentro del bloque `BEGIN-END` para realizar las acciones requeridas.

2. **INSTEAD OF TRIGGER:**

Un `INSTEAD OF TRIGGER` se ejecuta en lugar de la acci贸n original que lo activ贸. Este tipo de `trigger` se utiliza com煤nmente en situaciones donde se desea realizar una validaci贸n adicional o una acci贸n personalizada antes de ejecutar la acci贸n original.

Ejemplo de un `INSTEAD OF TRIGGER` en la tabla `Customers` de la base de datos Northwind:

```
CREATE TRIGGER InsteadOfDeleteCustomer
ON Customers
INSTEAD OF DELETE
AS
BEGIN
    -- C贸digo del trigger
END;
```

En este ejemplo, el trigger "`InsteadOfDeleteCustomer`" se ejecutar谩 en lugar de la operaci贸n `DELETE` en la tabla "`Customers`". Puedes proporcionar el c贸digo necesario dentro del bloque `BEGIN-END` para realizar las acciones personalizadas antes de realizar la eliminaci贸n.

Los triggers pueden ser 煤tiles en diversas situaciones, como:

- **Mantener la integridad referencial:** Pueden utilizarse para asegurarse de que los datos insertados, actualizados o eliminados cumplan con las restricciones y reglas establecidas en la base de datos.

- **Auditor铆a de cambios:** Permiten registrar informaci贸n sobre las acciones realizadas en una tabla, como qui茅n realiz贸 la acci贸n y cu谩ndo.

- **Actualizaciones autom谩ticas:** Pueden utilizarse para actualizar autom谩ticamente datos en otras tablas en funci贸n de las modificaciones realizadas en una tabla.

Es importante tener en cuenta que el uso de `triggers` puede afectar el rendimiento de la base de datos, especialmente si se ejecutan instrucciones complejas o se realizan operaciones costosas. Por lo tanto, se recomienda utilizar los `triggers` de manera cuidadosa y evaluar su impacto en el rendimiento del sistema.

En resumen, los `triggers` en SQL Server son objetos de base de datos que se utilizan para ejecutar acciones autom谩ticas en respuesta a eventos espec铆ficos en una tabla. Pueden ser `AFTER TRIGGERS`, que se ejecutan despu茅s de la acci贸n original, o `INSTEAD OF TRIGGERS`, que se ejecutan en lugar de la acci贸n original. Los `triggers` son una herramienta poderosa para mantener la integridad de los datos y automatizar tareas en una base de datos.

[](#铆ndice)

---

## **Creaci贸n de Trigger de tipo INSERT**

Para crear un `trigger` de tipo `INSERT` en SQL Server, se utiliza la cl谩usula `AFTER INSERT` en la declaraci贸n `CREATE TRIGGER`. El `trigger` se activar谩 autom谩ticamente despu茅s de que se haya insertado una fila en la tabla especificada. Aqu铆 tienes un ejemplo de creaci贸n de un `trigger` de tipo `INSERT` en la base de datos Northwind:

```
-- Crear una tabla para almacenar el historial de pedidos
CREATE TABLE OrderHistory (
    OrderID INT,
    OrderDate DATETIME,
    CustomerID VARCHAR(5),
    TotalAmount MONEY
);

-- Crear el trigger de tipo INSERT
CREATE TRIGGER InsertOrderHistory
ON Orders
AFTER INSERT
AS
BEGIN
    -- Insertar los datos del pedido en la tabla OrderHistory
    INSERT INTO OrderHistory (OrderID, OrderDate, CustomerID, TotalAmount)
    SELECT OrderID, OrderDate, CustomerID, TotalAmount
    FROM inserted;
END;
```

En este ejemplo, se crea una tabla llamada `OrderHistory` que se utilizar谩 para almacenar el historial de pedidos. A continuaci贸n, se crea el trigger `InsertOrderHistory` en la tabla `Orders`. El trigger se ejecutar谩 despu茅s de que se haya insertado una fila en la tabla `Orders`. Dentro del bloque `BEGIN-END` del trigger, se utiliza la instrucci贸n `INSERT INTO` para insertar los datos del pedido en la tabla `OrderHistory`. La cl谩usula `SELECT` se utiliza junto con la tabla especial inserted para obtener los datos de la fila insertada en la tabla `Orders`.

Cuando se inserte una nueva fila en la tabla `Orders`, el trigger `InsertOrderHistory` se activar谩 autom谩ticamente y registrar谩 los datos del pedido en la tabla `OrderHistory`. Esto proporciona un registro hist贸rico de todos los pedidos realizados en la base de datos.

Es importante destacar que el c贸digo dentro del trigger puede ser personalizado seg煤n los requisitos espec铆ficos. En este ejemplo, solo se insertan los datos del pedido en la tabla `OrderHistory`, pero puedes agregar l贸gica adicional, como validaciones o actualizaciones en otras tablas, seg煤n sea necesario.

Los triggers de tipo `INSERT` son 煤tiles para realizar acciones adicionales despu茅s de insertar datos en una tabla. Pueden utilizarse para auditar cambios, mantener la integridad de los datos o realizar c谩lculos autom谩ticos. Sin embargo, es importante tener en cuenta que los triggers pueden afectar el rendimiento de la base de datos, por lo que se recomienda utilizarlos con prudencia y considerar su impacto en el rendimiento del sistema.

[](#铆ndice)

---

## **Conclusi贸n**

En conclusi贸n, los `triggers` en SQL Server son objetos de base de datos que se utilizan para realizar acciones autom谩ticas en respuesta a eventos espec铆ficos, como operaciones de inserci贸n, actualizaci贸n o eliminaci贸n en una tabla. Proporcionan una forma de implementar l贸gica empresarial adicional o mantener la integridad de los datos en la base de datos.

Los `triggers` se definen en una tabla y se activan autom谩ticamente cuando ocurre un evento especificado. Pueden realizar acciones como insertar, actualizar, eliminar registros en otras tablas, generar registros de auditor铆a, aplicar validaciones adicionales, entre otros. Los `triggers` son 煤tiles cuando se requiere realizar acciones adicionales o realizar verificaciones antes o despu茅s de realizar cambios en los datos.

Un ejemplo concreto de uso de `triggers` en la base de datos Northwind ser铆a el siguiente:

Supongamos que deseamos mantener un registro de cambios en la tabla de productos cada vez que se realice una actualizaci贸n en el campo `UnitPrice`. Podemos crear un `trigger` que registre autom谩ticamente el cambio en una tabla de auditor铆a:

```
-- Crear tabla de auditor铆a para cambios en productos
CREATE TABLE ProductAudit (
    ProductID INT,
    OldUnitPrice MONEY,
    NewUnitPrice MONEY,
    ChangeDate DATETIME
);

-- Crear el trigger de tipo UPDATE
CREATE TRIGGER UpdateProductAudit
ON Products
AFTER UPDATE
AS
BEGIN
    -- Insertar los datos del cambio en la tabla ProductAudit
    INSERT INTO ProductAudit (ProductID, OldUnitPrice, NewUnitPrice, ChangeDate)
    SELECT ProductID, UnitPrice AS OldUnitPrice, i.UnitPrice AS NewUnitPrice, GETDATE()
    FROM inserted i
    INNER JOIN deleted d ON i.ProductID = d.ProductID
    WHERE i.UnitPrice <> d.UnitPrice;
END;
```

En este ejemplo, se crea una tabla llamada `ProductAudit` para almacenar los registros de auditor铆a de cambios en el precio de los productos. Luego se crea el `trigger` `UpdateProductAudit` en la tabla `Products`, que se activar谩 despu茅s de una operaci贸n de actualizaci贸n en la tabla. Dentro del bloque `BEGIN-END` del `trigger`, se utiliza la instrucci贸n `INSERT INTO` para insertar los datos del cambio en la tabla `ProductAudit`. Se utiliza la tabla especial `inserted` para obtener los nuevos valores de `UnitPrice` y la tabla especial `deleted` para obtener los valores antiguos de `UnitPrice`. Se realiza una comparaci贸n para determinar si ha habido un cambio en el precio y solo se insertan los registros modificados en la tabla `ProductAudit` junto con la fecha y hora del cambio.

Al implementar este `trigger`, cada vez que se realice una actualizaci贸n en el campo `UnitPrice` de la tabla `Products`, se registrar谩 autom谩ticamente el cambio en la tabla `ProductAudit`. Esto proporciona un registro de auditor铆a que puede ser 煤til para fines de seguimiento y control.

En resumen, los `triggers` en SQL Server son herramientas poderosas que permiten automatizar acciones en respuesta a eventos espec铆ficos en una base de datos. Pueden ayudar a mantener la integridad de los datos, implementar reglas de negocio adicionales y generar registros de auditor铆a. Sin embargo, es importante utilizar los `triggers` con cuidado y considerar su impacto en el rendimiento de la base de datos, ya que pueden afectar el tiempo de ejecuci贸n de las operaciones.

[](#铆ndice)

---

| **Inicio**            | **atr谩s 17**         | **Siguiente 19**                        |
| --------------------- | -------------------- | --------------------------------------- |
| [](../../README.md) | [](./17.Vistas.md) | [](./19.Backup_y_Restore_DataBase.md) |
