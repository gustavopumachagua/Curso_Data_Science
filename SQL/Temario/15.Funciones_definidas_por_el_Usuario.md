| **Inicio**            | **atr谩s 14**                           | **Siguiente 16**                |
| --------------------- | -------------------------------------- | ------------------------------- |
| [](../../README.md) | [](./14.JOIN_UNIONS_entre_tablas.md) | [](./16.Tablas_Temporales.md) |

---

## **ndice**

| Temario                                                     |
| ----------------------------------------------------------- |
| [Introducci贸n](#introducci贸n)                               |
| [Funciones de tipo Escalares](#funciones-de-tipo-escalares) |
| [Funciones de tipo Tabla](#funciones-de-tipo-tabla)         |

---

# **Funciones definidas por el Usuario**

---

## **Introducci贸n**

Las funciones definidas por el usuario en SQL Server son funciones personalizadas que puedes crear para realizar operaciones espec铆ficas y complejas en los datos de la base de datos. Estas funciones se pueden utilizar en consultas SQL de la misma manera que las funciones incorporadas en SQL Server.

Aqu铆 tienes una explicaci贸n detallada de las funciones definidas por el usuario, junto con un ejemplo utilizando la base de datos Northwind:

Tipos de funciones definidas por el usuario:

1. En SQL Server, puedes crear tres tipos de funciones definidas por el usuario:

- **Funciones escalares:** Devuelven un solo valor basado en los par谩metros de entrada.
- **Funciones en l铆nea:** Devuelven una tabla en l铆nea que puede ser utilizada en la cl谩usula `FROM` de una consulta.
- **Funciones de tabla:** Devuelven una tabla completa que puede ser tratada como una tabla independiente en una consulta.

2. Creaci贸n de funciones definidas por el usuario:

Para crear una funci贸n definida por el usuario, debes seguir los siguientes pasos:

- Especifica el nombre de la funci贸n y los par谩metros de entrada (si los hay).
- Define el tipo de retorno de la funci贸n.
- Implementa la l贸gica de la funci贸n utilizando sentencias SQL.
- Opcionalmente, agrega declaraciones variables, condiciones `IF`, bucles `WHILE`, etc.

3. Ejemplo de funci贸n definida por el usuario:

Supongamos que queremos crear una funci贸n que devuelva el n煤mero de productos en una categor铆a espec铆fica. Utilizaremos la base de datos Northwind, donde tenemos la tabla "`Products`" y la tabla "`Categories`".

Ejemplo de funci贸n definida por el usuario:

```
USE Northwind;
GO

CREATE FUNCTION dbo.GetProductCountByCategory(@categoryName NVARCHAR(50))
RETURNS INT
AS
BEGIN
    DECLARE @productCount INT;
    SET @productCount = (
        SELECT COUNT(*)
        FROM Products P
        INNER JOIN Categories C ON P.CategoryID = C.CategoryID
        WHERE C.CategoryName = @categoryName
    );
    RETURN @productCount;
END;
```

En este ejemplo, creamos una funci贸n llamada "`GetProductCountByCategory`" que acepta un par谩metro de entrada "`categoryName`". La funci贸n utiliza una consulta SQL para contar el n煤mero de productos en la categor铆a especificada. Luego, se retorna el resultado utilizando la instrucci贸n "`RETURN`".

4. Uso de funciones definidas por el usuario:

Una vez que has creado una funci贸n definida por el usuario, puedes utilizarla en consultas SQL de la misma manera que las funciones incorporadas. Por ejemplo:

`SELECT dbo.GetProductCountByCategory('Beverages') AS BeverageProductCount;`

Esta consulta utiliza la funci贸n definida por el usuario para obtener el recuento de productos en la categor铆a '`Beverages`'. El resultado se mostrar谩 en una columna llamada "`BeverageProductCount`".

Las funciones definidas por el usuario son una forma poderosa de encapsular l贸gica personalizada y reutilizable en SQL Server. Puedes crear funciones para realizar c谩lculos complejos, manipular datos y realizar transformaciones espec铆ficas. Esto ayuda a simplificar las consultas y mejorar la modularidad y mantenibilidad del c贸digo SQL.

[](#铆ndice)

---

## **Funciones de tipo Escalares**

Las funciones de tipo escalar en SQL Server son funciones definidas por el usuario que devuelven un solo valor basado en los par谩metros de entrada. Estas funciones se utilizan para realizar c谩lculos o manipulaciones de datos espec铆ficas y se pueden utilizar en cualquier lugar donde se espera un valor en una consulta SQL.

Aqu铆 tienes una explicaci贸n detallada de las funciones de tipo escalar, junto con un ejemplo utilizando la base de datos Northwind:

1. Creaci贸n de funciones escalares:

Para crear una funci贸n escalar, debes seguir los siguientes pasos:

- Especifica el nombre de la funci贸n y los par谩metros de entrada (si los hay).
- Define el tipo de retorno de la funci贸n.
- Implementa la l贸gica de la funci贸n utilizando sentencias SQL.
- Opcionalmente, agrega declaraciones variables, condiciones `IF`, bucles `WHILE`, etc.

2. Ejemplo de funci贸n escalar:

Supongamos que queremos crear una funci贸n que calcule el precio total de un pedido en funci贸n de la cantidad y el precio unitario. Utilizaremos la base de datos Northwind, donde tenemos la tabla "`OrderDetails`" que contiene informaci贸n sobre los productos en cada pedido.

Ejemplo de funci贸n escalar:

```
USE Northwind;
GO

CREATE FUNCTION dbo.CalculateOrderTotal(@quantity INT, @unitPrice MONEY)
RETURNS MONEY
AS
BEGIN
    DECLARE @totalPrice MONEY;
    SET @totalPrice = @quantity * @unitPrice;
    RETURN @totalPrice;
END;
```

En este ejemplo, creamos una funci贸n llamada "`CalculateOrderTotal`" que acepta dos par谩metros de entrada: `@quantity` (cantidad) y `@unitPrice` (precio unitario). La funci贸n realiza un c谩lculo simple multiplicando la cantidad por el precio unitario y retorna el resultado como un valor de tipo `MONEY`.

3. Uso de funciones escalares:

Una vez que has creado una funci贸n escalar, puedes utilizarla en consultas SQL de la misma manera que las funciones incorporadas. Por ejemplo:

```
SELECT OrderID, ProductID, Quantity, UnitPrice, dbo.CalculateOrderTotal(Quantity, UnitPrice) AS OrderTotal
FROM OrderDetails;
```

Esta consulta utiliza la funci贸n escalar "`CalculateOrderTotal`" para calcular el precio total de cada pedido en la tabla "`OrderDetails`". El resultado se muestra en una columna llamada "`OrderTotal`".

Las funciones escalares en SQL Server son 煤tiles cuando necesitas realizar c谩lculos simples o manipulaciones de datos en una consulta y deseas encapsular esa l贸gica en una funci贸n reutilizable. Puedes usar funciones escalares para realizar operaciones matem谩ticas, concatenaci贸n de cadenas, conversi贸n de tipos de datos, manipulaci贸n de fechas, entre otras tareas. Al utilizar funciones escalares, puedes simplificar y modularizar tus consultas SQL, mejorando la legibilidad y el mantenimiento del c贸digo.

[](#铆ndice)

---

## **Funciones de tipo Tabla**

Las funciones de tipo tabla en SQL Server son funciones definidas por el usuario que devuelven un conjunto de resultados en forma de tabla. Estas funciones se utilizan para realizar consultas m谩s complejas y devolver un conjunto de registros que se pueden utilizar en otras partes de una consulta SQL, como la cl谩usula `FROM`.

Aqu铆 tienes una explicaci贸n detallada de las funciones de tipo tabla, junto con un ejemplo utilizando la base de datos Northwind:

1. Creaci贸n de funciones de tipo tabla:

Para crear una funci贸n de tipo tabla, debes seguir los siguientes pasos:

- Especifica el nombre de la funci贸n y los par谩metros de entrada (si los hay).
- Define la estructura de la tabla que ser谩 devuelta por la funci贸n.
- Implementa la l贸gica de la funci贸n utilizando sentencias SQL.
- Rellena la tabla de resultados utilizando instrucciones `INSERT`, `SELECT`, o cualquier otra operaci贸n necesaria.

2. Ejemplo de funci贸n de tipo tabla:

Supongamos que queremos crear una funci贸n que devuelva los productos de una categor铆a espec铆fica. Utilizaremos la base de datos Northwind, donde tenemos la tabla "`Products`" y la tabla "`Categories`".

Ejemplo de funci贸n de tipo tabla:

```
USE Northwind;
GO

CREATE FUNCTION dbo.GetProductsByCategory(@categoryName NVARCHAR(50))
RETURNS TABLE
AS
RETURN
(
    SELECT P.ProductID, P.ProductName, P.UnitPrice
    FROM Products P
    INNER JOIN Categories C ON P.CategoryID = C.CategoryID
    WHERE C.CategoryName = @categoryName
);
```

En este ejemplo, creamos una funci贸n llamada "`GetProductsByCategory`" que acepta un par谩metro de entrada "`categoryName`". La funci贸n devuelve una tabla con tres columnas: `ProductID`, `ProductName` y `UnitPrice`. La funci贸n realiza una consulta SQL para seleccionar los productos de la categor铆a especificada utilizando una cl谩usula `INNER JOIN` con la tabla "`Categories`".

3. Uso de funciones de tipo tabla:

Una vez que has creado una funci贸n de tipo tabla, puedes utilizarla en consultas SQL de la misma manera que una tabla real. Por ejemplo:

```
SELECT *
FROM dbo.GetProductsByCategory('Beverages');
```

Esta consulta utiliza la funci贸n de tipo tabla "`GetProductsByCategory`" para obtener los productos de la categor铆a '`Beverages`'. Los resultados se mostrar谩n como si fueran el resultado de una consulta normal, con las columnas `ProductID`, `ProductName` y `UnitPrice`.

Las funciones de tipo tabla en SQL Server son 煤tiles cuando necesitas encapsular una consulta compleja y devolver un conjunto de resultados que se pueden utilizar en otras partes de una consulta. Puedes utilizar funciones de tipo tabla para realizar consultas avanzadas, filtrar datos, realizar c谩lculos o cualquier otra operaci贸n necesaria para obtener los resultados deseados. Al utilizar funciones de tipo tabla, puedes modularizar y reutilizar l贸gica de consulta compleja, mejorando la legibilidad y el rendimiento de tus consultas SQL.

[](#铆ndice)

---

| **Inicio**            | **atr谩s 14**                           | **Siguiente 16**                |
| --------------------- | -------------------------------------- | ------------------------------- |
| [](../../README.md) | [](./14.JOIN_UNIONS_entre_tablas.md) | [](./16.Tablas_Temporales.md) |
