| **Inicio**            | **atr√°s 20**                 | **Siguiente 22**                  |
| --------------------- | ---------------------------- | --------------------------------- |
| [üè†](../../README.md) | [‚è™](./20.Scheduled_JOBS.md) | [‚è©](./22.SQL_SERVER_Profiler.md) |

---

## **√çndice**

| Temario                                                                                                              |
| -------------------------------------------------------------------------------------------------------------------- |
| [Introducci√≥n](#introducci√≥n)                                                                                        |
| [Usuarios y Logins](#usuarios-y-logins)                                                                              |
| [Roles de Base de Datos: tipos posibles](#roles-de-base-de-datos-tipos-posibles)                                     |
| [Crear y asignar un Rol a un Usuario desde T-SQL](#crear-y-asignar-un-rol-a-un-usuario-desde-t-sql)                  |
| [¬øQu√© es un Schema? ‚Äì Como asignar un esquema a un objeto](#¬øqu√©-es-un-schema-‚Äì-como-asignar-un-esquema-a-un-objeto) |
| [Descripci√≥n de Roles de Servidor y Roles Predefinidos](#descripci√≥n-de-roles-de-servidor-y-roles-predefinidos)      |

---

# **Administraci√≥n de usuarios, roles, shemas y permisos**

---

## **Introducci√≥n**

La administraci√≥n de usuarios, roles, esquemas y permisos en SQL Server es fundamental para garantizar la seguridad y el control de acceso a la base de datos. Estos elementos permiten gestionar qui√©n puede acceder a la base de datos, qu√© acciones pueden realizar y en qu√© objetos pueden operar. A continuaci√≥n, explicar√© cada uno de estos conceptos en detalle, junto con ejemplos utilizando la base de datos Northwind.

1. **Usuarios:** Un usuario en SQL Server es una entidad que representa a una persona o aplicaci√≥n que interact√∫a con la base de datos. Cada usuario tiene un nombre de inicio de sesi√≥n (`login`) y un nombre de usuario en la base de datos. El inicio de sesi√≥n se utiliza para autenticar al usuario en el servidor, mientras que el nombre de usuario se utiliza para asociar permisos y roles en la base de datos.

Ejemplo: Para crear un nuevo usuario llamado "`John`" en la base de datos Northwind, se puede utilizar la siguiente instrucci√≥n:

```
CREATE LOGIN John WITH PASSWORD = 'Password123';
USE Northwind;
CREATE USER John FOR LOGIN John;
```

2. **Roles:** Los roles en SQL Server son grupos l√≥gicos que contienen usuarios y se utilizan para simplificar la asignaci√≥n de permisos. Los roles pueden tener permisos asignados y los usuarios pueden ser miembros de uno o varios roles. Esto permite administrar los permisos de forma m√°s eficiente y centralizada.

Ejemplo: Para crear un nuevo rol llamado "`Vendedor`" en la base de datos Northwind y asignarle el usuario "`John`", se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
CREATE ROLE Vendedor;
ALTER ROLE Vendedor ADD MEMBER John;
```

3. **Esquemas:** Los esquemas en SQL Server son contenedores l√≥gicos que agrupan objetos de la base de datos, como tablas, vistas, funciones, etc. Los esquemas se utilizan para organizar y estructurar los objetos en la base de datos. Tambi√©n se pueden utilizar para asignar permisos a nivel de esquema, lo que facilita la gesti√≥n de permisos.

Ejemplo: Para crear un nuevo esquema llamado "`Ventas`" en la base de datos Northwind y asignarle permisos al rol "`Vendedor`", se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
CREATE SCHEMA Ventas;
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::Ventas TO Vendedor;
```

4. **Permisos:** Los permisos en SQL Server determinan qu√© acciones pueden realizar los usuarios y roles en los objetos de la base de datos. Los permisos se asignan a nivel de objeto y pueden incluir permisos de lectura, escritura, modificaci√≥n de esquemas, eliminaci√≥n, entre otros. Se pueden asignar permisos directamente a usuarios o roles, o a trav√©s de la asignaci√≥n de permisos a nivel de esquema.

Ejemplo: Para asignar permisos de lectura y escritura en la tabla "`Customers`" a un usuario espec√≠fico llamado "`John`", se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
GRANT SELECT, INSERT, UPDATE ON Customers TO John;
```

En resumen, la administraci√≥n de usuarios, roles, esquemas y permisos en SQL Server es esencial para garantizar la seguridad y el control de acceso a la base de datos. Estos elementos permiten gestionar qui√©n puede acceder a la base de datos, qu√© acciones pueden realizar y en qu√© objetos pueden operar. Al utilizar adecuadamente estos componentes, se logra una administraci√≥n eficiente y segura de la base de datos, protegiendo la integridad y confidencialidad de los datos.

---

[üîº](#√≠ndice)

## **Usuarios y Logins**

En SQL Server, los usuarios y logins son dos conceptos relacionados pero distintos que se utilizan para gestionar el acceso a la base de datos. A continuaci√≥n, explicar√© cada uno de ellos en detalle, junto con ejemplos utilizando la base de datos Northwind.

1. **Logins:** Un login en SQL Server es una identidad utilizada para autenticar a un usuario en el servidor. Representa una cuenta de inicio de sesi√≥n que puede ser utilizada para acceder al servidor de base de datos. Los logins pueden ser de diferentes tipos, como logins de Windows, logins de SQL Server o logins de Active Directory.

Ejemplo: Para crear un nuevo login de SQL Server llamado "`mylogin`" con una contrase√±a, se puede utilizar la siguiente instrucci√≥n:

```
USE master;
CREATE LOGIN mylogin WITH PASSWORD = 'Password123';
```

2. **Usuarios:** Un usuario en SQL Server est√° asociado a un login y se utiliza para controlar el acceso a una base de datos espec√≠fica. Un usuario se crea en el contexto de una base de datos y se asocia con un login existente en el servidor. Cada usuario en una base de datos tiene sus propios permisos y derechos de acceso.

Ejemplo: Para crear un nuevo usuario llamado "`myuser`" asociado al login "`mylogin`" en la base de datos Northwind, se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
CREATE USER myuser FOR LOGIN mylogin;
```

Es importante tener en cuenta que el login se crea en el nivel del servidor y puede tener acceso a m√∫ltiples bases de datos, mientras que el usuario se crea en el contexto de una base de datos espec√≠fica y solo tiene acceso a esa base de datos.

En resumen, los logins y usuarios en SQL Server se utilizan para gestionar el acceso y autenticaci√≥n de los usuarios en el servidor y en las bases de datos respectivamente. Los logins representan las cuentas de inicio de sesi√≥n utilizadas para autenticar a los usuarios en el servidor, mientras que los usuarios est√°n asociados a logins y tienen permisos y derechos de acceso en una base de datos espec√≠fica.

---

[üîº](#√≠ndice)

## **Roles de Base de Datos: tipos posibles**

En SQL Server, los roles de base de datos son un mecanismo utilizado para agrupar usuarios y asignarles permisos de manera m√°s eficiente. Los roles permiten simplificar la administraci√≥n de permisos al asignarlos a un grupo de usuarios en lugar de hacerlo individualmente. A continuaci√≥n, explicar√© algunos de los tipos de roles de base de datos disponibles en SQL Server, junto con ejemplos utilizando la base de datos Northwind.

1. **Roles predefinidos:**

- **db_owner:** Este rol tiene todos los permisos en la base de datos y puede realizar cualquier operaci√≥n.
- **db_datareader:** Este rol permite leer todos los datos en la base de datos.
- **db_datawriter:** Este rol permite escribir datos en la base de datos.

Ejemplo: Para agregar un usuario llamado "`myuser`" al rol predefinido "`db_datareader`" en la base de datos Northwind, se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
EXEC sp_addrolemember 'db_datareader', 'myuser';
```

2. **Roles personalizados:**

Adem√°s de los roles predefinidos, es posible crear roles personalizados para adaptarse a las necesidades espec√≠ficas de la aplicaci√≥n. Los roles personalizados se pueden utilizar para agrupar usuarios y asignarles permisos de manera coherente.

Ejemplo: Para crear un rol personalizado llamado "`myrole`" en la base de datos Northwind, se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
CREATE ROLE myrole;
```

3. **Roles de aplicaci√≥n:**

Los roles de aplicaci√≥n se utilizan para asignar permisos a aplicaciones en lugar de usuarios individuales. Esto permite controlar los permisos de manera centralizada para todas las instancias de la aplicaci√≥n.

Ejemplo: Para agregar un usuario de aplicaci√≥n llamado "`myappuser`" al rol de aplicaci√≥n "`myapprole`" en la base de datos Northwind, se puede utilizar la siguiente instrucci√≥n:

```
USE Northwind;
EXEC sp_addapprole 'myapprole', 'password123';
```

Es importante tener en cuenta que los roles pueden ser anidados, lo que significa que un rol puede contener otros roles. Esto permite una gesti√≥n de permisos m√°s granular y organizada.

En resumen, los roles de base de datos en SQL Server permiten agrupar usuarios y asignarles permisos de manera eficiente. Los roles predefinidos ofrecen un conjunto de permisos comunes, mientras que los roles personalizados y de aplicaci√≥n se utilizan para adaptarse a las necesidades espec√≠ficas de la aplicaci√≥n. Al utilizar roles, se simplifica la administraci√≥n de permisos al asignarlos a grupos de usuarios en lugar de hacerlo individualmente.

---

[üîº](#√≠ndice)

## **Crear y asignar un Rol a un Usuario desde T-SQL**

Para crear y asignar un rol a un usuario en SQL Server utilizando T-SQL, puedes seguir los siguientes pasos:

1. **Crear el rol:**

Utiliza la instrucci√≥n `CREATE ROLE` para crear un nuevo rol en la base de datos deseada. Puedes especificar los permisos que deseas asignar al rol seg√∫n tus necesidades.

Ejemplo:

```
USE Northwind;
CREATE ROLE MyRole;
```

2. **Agregar el usuario al rol:**

Utiliza la instrucci√≥n `ALTER ROLE` para agregar un usuario existente al rol reci√©n creado.

Ejemplo:

```
USE Northwind;
ALTER ROLE MyRole ADD MEMBER myuser;
```

En el ejemplo anterior, myuser es el nombre del usuario al que deseas asignar el rol `MyRole`.

3. **Asignar permisos al rol:**

Utiliza la instrucci√≥n `GRANT` para asignar los permisos deseados al rol. Puedes otorgar permisos a nivel de objeto (tablas, vistas, procedimientos almacenados, etc.) o permisos a nivel de base de datos.

Ejemplo:

```
USE Northwind;
GRANT SELECT, INSERT, UPDATE ON Customers TO MyRole;
```

En el ejemplo anterior, se otorgan permisos de `SELECT`, `INSERT` y `UPDATE` en la tabla `Customers` al rol `MyRole`.

Recuerda que debes tener los permisos adecuados para crear roles y asignarlos a usuarios. Adem√°s, aseg√∫rate de reemplazar "`Northwind`" con el nombre de tu base de datos.

Al asignar un rol a un usuario, este heredar√° los permisos del rol y podr√° realizar las operaciones permitidas por ese rol en la base de datos.

Es importante tener en cuenta que los roles tambi√©n se pueden asignar a roles existentes, lo que permite una estructura de roles jer√°rquica y m√°s compleja seg√∫n sea necesario.

Ten en cuenta que este es solo un ejemplo y debes adaptarlo a tus necesidades espec√≠ficas y a la estructura de tu base de datos.

---

[üîº](#√≠ndice)

## **¬øQu√© es un Schema? ‚Äì Como asignar un esquema a un objeto**

En SQL Server, un esquema (`schema`) es un contenedor l√≥gico que se utiliza para organizar y agrupar objetos de base de datos, como tablas, vistas, funciones, procedimientos almacenados, etc. Proporciona una forma de estructurar y separar los objetos en la base de datos, lo que facilita la administraci√≥n y el mantenimiento del sistema.

Cada base de datos en SQL Server puede contener m√∫ltiples esquemas, y cada esquema puede contener varios objetos. Los esquemas proporcionan una forma de organizar y separar los objetos seg√∫n su prop√≥sito o funci√≥n, lo que facilita su gesti√≥n y el control de acceso.

Para asignar un esquema a un objeto en SQL Server, puedes seguir los siguientes pasos:

1. **Crear un esquema:**

Utiliza la instrucci√≥n `CREATE SCHEMA` para crear un nuevo esquema en la base de datos deseada.

Ejemplo:

```
USE Northwind;
CREATE SCHEMA MySchema;
```

2. **Asignar un objeto a un esquema:**

Puedes asignar un objeto a un esquema espec√≠fico durante la creaci√≥n del objeto o modificar el esquema de un objeto existente utilizando la instrucci√≥n `ALTER SCHEMA`.

Ejemplo:

```
USE Northwind;
CREATE TABLE MySchema.MyTable (
    ID INT PRIMARY KEY,
    Name VARCHAR(50)
);
```

En el ejemplo anterior, se crea una nueva tabla llamada `MyTable` y se asigna al esquema `MySchema`.

Tambi√©n puedes modificar el esquema de un objeto existente utilizando la instrucci√≥n `ALTER SCHEMA`.

Ejemplo:

```
USE Northwind;
ALTER SCHEMA MySchema TRANSFER dbo.MyTable;
```

En el ejemplo anterior, se cambia el esquema de la tabla `MyTable` del esquema `dbo` al esquema `MySchema`.

Al asignar un objeto a un esquema, puedes especificar el nombre completo del objeto en la forma esquema.objeto. Por ejemplo, `MySchema.MyTable` se refiere a la tabla `MyTable` en el esquema `MySchema`.

Los esquemas proporcionan una forma conveniente de organizar y separar los objetos en la base de datos. Tambi√©n ayudan a evitar conflictos de nombres y proporcionan una mayor modularidad en la administraci√≥n de la base de datos.

Es importante tener en cuenta que los permisos de acceso a los objetos en un esquema deben ser asignados correctamente a los usuarios y roles correspondientes para garantizar la seguridad y el control de acceso adecuados.

Recuerda que este es solo un ejemplo y debes adaptarlo a tus necesidades espec√≠ficas y a la estructura de tu base de datos.

---

[üîº](#√≠ndice)

## **Descripci√≥n de Roles de Servidor y Roles Predefinidos**

En SQL Server, existen dos tipos de roles: roles de servidor y roles predefinidos. Estos roles son utilizados para administrar y asignar permisos a los usuarios en el servidor de base de datos. A continuaci√≥n, explicar√© cada tipo de rol y proporcionar√© ejemplos utilizando la base de datos Northwind.

1. **Roles de servidor:**

Los roles de servidor son roles que se definen a nivel de servidor y est√°n dise√±ados para administrar y controlar el acceso a los recursos del servidor. Estos roles se utilizan para asignar permisos y responsabilidades a nivel de servidor, y los usuarios asignados a estos roles obtienen autom√°ticamente los permisos asociados a ellos.

Algunos ejemplos de roles de servidor en SQL Server son:

- **sysadmin:** Este rol tiene todos los permisos en el servidor y se utiliza para administradores del sistema.
- **serveradmin:** Este rol tiene permisos de administraci√≥n del servidor, pero no tiene acceso a bases de datos espec√≠ficas.
- **setupadmin:** Este rol tiene permisos para administrar la configuraci√≥n del servidor.
- **bulkadmin:** Este rol tiene permisos para realizar operaciones de carga masiva de datos.

Ejemplo:

```
USE master;
CREATE LOGIN MyLogin WITH PASSWORD = 'MyPassword';
ALTER SERVER ROLE sysadmin ADD MEMBER MyLogin;
```

En el ejemplo anterior, se crea un nuevo inicio de sesi√≥n llamado `MyLogin` y se agrega como miembro del rol de servidor `sysadmin`, lo que le otorga todos los permisos en el servidor.

2. **Roles predefinidos:**

Los roles predefinidos son roles que se crean autom√°ticamente al crear una base de datos en SQL Server. Estos roles se utilizan para asignar permisos y responsabilidades a nivel de base de datos, y los usuarios asignados a estos roles obtienen autom√°ticamente los permisos asociados a ellos.

Algunos ejemplos de roles predefinidos en SQL Server son:

- **db_owner:** Este rol tiene todos los permisos en una base de datos y se utiliza para administradores de la base de datos.
- **db_datareader:** Este rol tiene permisos para leer todos los datos en una base de datos.
- **db_datawriter:** Este rol tiene permisos para insertar, actualizar y eliminar datos en una base de datos.
- **db_executor:** Este rol tiene permisos para ejecutar procedimientos almacenados y funciones en una base de datos.

Ejemplo:

```
USE Northwind;
CREATE USER MyUser FOR LOGIN MyLogin;
ALTER ROLE db_datareader ADD MEMBER MyUser;
```

En el ejemplo anterior, se crea un nuevo usuario llamado `MyUser` asociado al inicio de sesi√≥n `MyLogin` y se agrega como miembro del rol predefinido `db_datareader`, lo que le otorga permisos para leer todos los datos en la base de datos Northwind.

Los roles de servidor y roles predefinidos proporcionan una forma conveniente de asignar permisos y controlar el acceso a nivel de servidor y base de datos. Al utilizar estos roles, puedes gestionar de manera efectiva los permisos de los usuarios y mantener la seguridad de tus bases de datos.

Es importante tener en cuenta que los roles deben asignarse cuidadosamente y seguir las mejores pr√°cticas de seguridad para garantizar un acceso adecuado y proteger la integridad de los datos.

---

[üîº](#√≠ndice)

| **Inicio**            | **atr√°s 20**                 | **Siguiente 22**                  |
| --------------------- | ---------------------------- | --------------------------------- |
| [üè†](../../README.md) | [‚è™](./20.Scheduled_JOBS.md) | [‚è©](./22.SQL_SERVER_Profiler.md) |
